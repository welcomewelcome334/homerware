<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOMERWARE Admin Panel</title>
<style>
/* -------------------- GLOBAL -------------------- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Segoe UI", sans-serif;
}

body {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #050b18;
  color: white;
  overflow: hidden;
  padding: 20px;
}

.background {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 20% 20%, #00b3ff55, transparent 40%), 
              radial-gradient(circle at 80% 80%, #007bff66, transparent 40%), 
              radial-gradient(circle at 50% 50%, #0050ff44, transparent 40%);
  filter: blur(70px);
  animation: move 12s ease-in-out infinite alternate;
  z-index: -1;
}

@keyframes move {
  0% { transform: translate(-5%, -5%) }
  100% { transform: translate(5%, 5%) }
}

/* -------------------- CONTAINER -------------------- */
.container {
  background: rgba(10,20,40,0.85);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  padding: 40px;
  width: 95%;
  max-width: 1000px;
  box-shadow: 0 0 50px rgba(0,140,255,0.4);
  text-align: center;
  overflow-x: auto;
}

h1 {
  font-size: 2.4rem;
  margin-bottom: 25px;
  letter-spacing: 3px;
  color: #4db8ff;
  text-shadow: 0 0 20px #2aa3ff, 0 0 40px #00c6ff;
}

/* -------------------- KEY INPUT & BUTTON -------------------- */
.key-box {
  width: 300px;
  padding: 16px;
  border-radius: 12px;
  border: 1px solid #2aa3ff;
  background: rgba(0,0,0,0.4);
  color: #8fd3ff;
  font-size: 1rem;
  text-align: center;
  outline: none;
  margin-bottom: 15px;
}

.copy-btn {
  padding: 12px 20px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(135deg,#0084ff,#00c6ff);
  color: white;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s ease;
  box-shadow: 0 0 20px rgba(0,160,255,0.5);
  margin-bottom: 20px;
}

.copy-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 35px rgba(0,180,255,0.9);
}

.footer {
  margin-bottom: 25px;
  font-size: 0.85rem;
  opacity: 0.7;
}

/* -------------------- TABLE -------------------- */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  color: #8fd3ff;
}

th, td {
  border: 1px solid #2aa3ff44;
  padding: 12px;
  text-align: left;
  font-size: 0.95rem;
}

th {
  color: #4db8ff;
  text-shadow: 0 0 10px #2aa3ff;
}

td button {
  padding: 6px 12px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg,#0084ff,#00c6ff);
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s ease;
  box-shadow: 0 0 15px rgba(0,160,255,0.5);
}

td button:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 30px rgba(0,180,255,0.9);
}

/* Scrollbar styling */
.container::-webkit-scrollbar {
  height: 8px;
  width: 8px;
}
.container::-webkit-scrollbar-thumb {
  background: #00c6ff66;
  border-radius: 8px;
}
</style>
</head>
<body>
<div class="background"></div>

<div class="container">
  <h1>HOMERWARE Admin Panel</h1>

  <input id="newKeyBox" class="key-box" readonly placeholder="Click generate">
  <button class="copy-btn" onclick="generatePermanentKey()">Generate Permanent Key</button>
  <div class="footer">Permanent keys never expire</div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Key</th>
        <th>HWID</th>
        <th>Created</th>
        <th>Expires</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>
</div>

<script>
const API = "/panel"; // Admin endpoints

// -------------------- LOAD KEYS --------------------
async function loadKeys() {
  try {
    const res = await fetch(`${API}/keys`);
    const keys = await res.json();
    const tbody = document.getElementById("table-body");
    tbody.innerHTML = "";
    keys.forEach(k => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${k.id}</td>
        <td>${k.key}</td>
        <td>${k.hwid || "â€”"}</td>
        <td>${new Date(k.createdAt).toLocaleString()}</td>
        <td>${k.expiresAt ? new Date(k.expiresAt).toLocaleString() : "Permanent"}</td>
        <td><button onclick='revokeKey("${k.id}")'>Revoke</button></td>
      `;
      tbody.appendChild(tr);
    });
  } catch(err) {
    alert("Failed to load keys.");
  }
}

// -------------------- GENERATE PERMANENT KEY --------------------
async function generatePermanentKey() {
  try {
    const res = await fetch("/panel/generate-key", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-admin-token": "HOMERWARE_SUPER_SECRET"
      }
    });
    const data = await res.json();
    if(data.success) {
      document.getElementById("newKeyBox").value = data.key;
    } else {
      alert("Failed to generate key.");
    }
  } catch(err) {
    alert("Server error, try again.");
  }
}


// -------------------- REVOKE KEY --------------------
async function revokeKey(id) {
  try {
    const res = await fetch(`${API}/revoke`, {
      method: "POST",
      headers: {"Content-Type":"application/json", "x-admin-token": "HOMERWARE_SUPER_SECRET"},
      body: JSON.stringify({id})
    });
    const data = await res.json();
    if(data.success) loadKeys();
  } catch(err) {
    alert("Failed to revoke key.");
  }
}

// -------------------- INIT --------------------
loadKeys();
</script>
</body>
</html>
