<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HOMERWARE Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  /* -------------------- GLOBAL -------------------- */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Segoe UI", sans-serif;
  }

  body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #050b18;
    color: white;
    overflow: hidden;
  }

  /* -------------------- BACKGROUND -------------------- */
  .background {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at 20% 20%, #00b3ff55, transparent 40%),
                radial-gradient(circle at 80% 80%, #007bff66, transparent 40%),
                radial-gradient(circle at 50% 50%, #0050ff44, transparent 40%);
    filter: blur(70px);
    animation: move 15s ease-in-out infinite alternate;
    z-index: -1;
  }

  @keyframes move {
    0% { transform: translate(-5%, -5%) }
    100% { transform: translate(5%, 5%) }
  }

  /* -------------------- LOADING SCREEN -------------------- */
  #loading-screen {
    position: fixed;
    inset: 0;
    background: #050b18;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    overflow: hidden;
    opacity: 1;
    transition: opacity 0.6s ease;
  }

  #loader-canvas {
    width: 150px;
    height: 150px;
  }

  .loading-text {
    color: #6fc9ff;
    font-size: 1.4rem;
    letter-spacing: 1px;
    text-shadow: 0 0 15px #2aa3ff, 0 0 30px #00c6ff;
    margin-top: 25px;
    font-weight: bold;
  }

  .tip {
    position: absolute;
    color: #00c6ffaa;
    font-size: 0.95rem;
    font-weight: bold;
    text-shadow: 0 0 10px #00c6ff, 0 0 25px #2aa3ff;
    animation: floatTip linear infinite;
    pointer-events: none;
  }

  @keyframes floatTip {
    0% { transform: translateY(0px) scale(0.8); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(-40px) scale(1); opacity: 0; }
  }

  /* -------------------- MAIN CONTAINER -------------------- */
  .container {
    background: rgba(10, 20, 40, 0.85);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 45px 30px;
    width: 90%;
    max-width: 520px;
    box-shadow: 0 0 60px rgba(0, 140, 255, 0.4);
    text-align: center;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .container.show {
    opacity: 1;
    transform: translateY(0);
  }

  h1 {
    font-size: 2.4rem;
    margin-bottom: 25px;
    letter-spacing: 3px;
    color: #4db8ff;
    text-shadow: 0 0 20px #2aa3ff, 0 0 40px #00c6ff;
  }

  .key-box {
    width: 100%;
    padding: 18px;
    border-radius: 12px;
    border: 1px solid #2aa3ff;
    background: rgba(0,0,0,0.4);
    color: #8fd3ff;
    font-size: 1.1rem;
    text-align: center;
    outline: none;
    margin-bottom: 25px;
    user-select: all;
    transition: 0.2s ease;
  }

  .key-box:focus {
    border-color: #00c6ff;
    box-shadow: 0 0 20px #00c6ff;
  }

  .copy-btn {
    width: 100%;
    padding: 16px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg,#0084ff,#00c6ff);
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s ease;
    box-shadow: 0 0 30px rgba(0,160,255,0.5);
  }

  .copy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 55px rgba(0,180,255,0.9);
  }

  .footer {
    margin-top: 20px;
    font-size: 0.85rem;
    opacity: 0.7;
  }

  #timer {
    margin-top: 10px;
    color: #6fc9ff;
    font-weight: 600;
  }
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loading-screen">
  <canvas id="loader-canvas"></canvas>
  <div class="loading-text">Generating key...</div>
  <div id="tips-container"></div>
</div>

<!-- BACKGROUND -->
<div class="background"></div>

<!-- MAIN CONTAINER -->
<div class="container">
  <h1>HOMERWARE</h1>
  <input id="keyBox" class="key-box" type="text" readonly placeholder="Generating key...">
  <button class="copy-btn" onclick="copyKey()">Copy To Clipboard</button>
  <div class="footer">Your unique HWID-based key</div>
  <div id="timer"></div>
</div>

<script>
const API = "/api";
const keyBox = document.getElementById("keyBox");
const timerEl = document.getElementById("timer");
const loader = document.getElementById("loading-screen");

// -------------------- HWID --------------------
function generateHWID() {
  const data = [
    navigator.userAgent,
    navigator.platform,
    navigator.language,
    screen.width + "x" + screen.height,
    screen.colorDepth
  ].join("|");
  return hashString(data);
}

function hashString(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = ((hash << 5) - hash) + str.charCodeAt(i);
    hash |= 0;
  }
  return Math.abs(hash).toString(16);
}

// -------------------- LOADING SCREEN & TIPS --------------------
const tips = [
  "Your HWID is unique!",
  "Keep your key safe!",
  "Your key saves even on refresh.",
  "Keys expire in 24 hours.",
  "Avoid sharing your key.",
  "Faster devices generate keys quicker.",
  "Neon is cool. Always.",
  "Watch the timer!"
];

function spawnTip() {
  const container = document.getElementById("tips-container");
  const tip = document.createElement("div");
  tip.className = "tip";
  tip.textContent = tips[Math.floor(Math.random() * tips.length)];
  tip.style.left = Math.random() * 90 + "vw";
  tip.style.top = Math.random() * 80 + "vh";
  const duration = 3 + Math.random()*2;
  tip.style.animationDuration = `${duration}s`;
  container.appendChild(tip);
  setTimeout(() => container.removeChild(tip), duration*1000);
}

const tipInterval = setInterval(spawnTip, 1000);

function hideLoader() {
  loader.style.opacity = "0";
  setTimeout(() => {
    loader.style.display = "none";
    document.querySelector(".container").classList.add("show");
    clearInterval(tipInterval);
  }, 600);
}

// -------------------- COOL LOADER PARTICLES --------------------
const canvas = document.getElementById("loader-canvas");
const ctx = canvas.getContext("2d");
canvas.width = 150;
canvas.height = 150;

const particles = [];
const PARTICLE_COUNT = 50;

for (let i=0;i<PARTICLE_COUNT;i++) {
  particles.push({
    angle: Math.random()*Math.PI*2,
    radius: 50 + Math.random()*20,
    speed: 0.02 + Math.random()*0.03,
    size: 2 + Math.random()*3,
    color: `hsl(${180 + Math.random()*60}, 100%, 60%)`
  });
}

function animateParticles() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);
  particles.forEach(p => {
    p.angle += p.speed;
    const x = Math.cos(p.angle) * p.radius;
    const y = Math.sin(p.angle) * p.radius;
    ctx.beginPath();
    ctx.arc(x, y, p.size, 0, Math.PI*2);
    ctx.fillStyle = p.color;
    ctx.shadowColor = p.color;
    ctx.shadowBlur = 12;
    ctx.fill();
  });
  ctx.restore();
  requestAnimationFrame(animateParticles);
}
animateParticles();

// -------------------- FETCH KEY --------------------
async function fetchKey() {
  const MIN_LOADING_TIME = 2500;
  const startTime = Date.now();
  try {
    const hwid = generateHWID();
    const res = await fetch(`${API}/get-key`, { method:"GET", headers: {"x-hwid": hwid} });
    const data = await res.json();
    keyBox.value = data.key;
    startTimer(data.expiresAt);
    const elapsed = Date.now() - startTime;
    setTimeout(hideLoader, Math.max(0, MIN_LOADING_TIME - elapsed));
  } catch(err) {
    keyBox.value = "Server offline";
    timerEl.textContent = "";
    const elapsed = Date.now() - startTime;
    setTimeout(hideLoader, Math.max(0, MIN_LOADING_TIME - elapsed));
  }
}

// -------------------- TIMER --------------------
function startTimer(expiresAt) {
  function update() {
    const remaining = Math.max(0, expiresAt - Date.now());
    const hrs = Math.floor(remaining / 3600000);
    const mins = Math.floor((remaining % 3600000)/60000);
    const secs = Math.floor((remaining % 60000)/1000);
    timerEl.textContent = `Expires in ${hrs}h ${mins}m ${secs}s`;
  }
  update();
  setInterval(update, 1000);
}

// -------------------- COPY KEY --------------------
function copyKey() {
  navigator.clipboard.writeText(keyBox.value);
  const btn = document.querySelector(".copy-btn");
  btn.innerText = "Copied!";
  setTimeout(() => btn.innerText = "Copy To Clipboard", 1500);
}

// -------------------- INIT --------------------
fetchKey();
</script>

</body>
</html>
